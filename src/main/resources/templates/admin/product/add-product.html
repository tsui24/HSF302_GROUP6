<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="author" content="Dương Quyền" />
    <title>Dashboard - Create Product</title>
    <script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        $(document).ready(() => {
            const avatarFile = $("#avatarFile");
            avatarFile.change(function (e) {
                const imgURL = URL.createObjectURL(e.target.files[0]);
                $("#avatarPreview").attr("src", imgURL);
                $("#avatarPreview").css({"display": "block"});
            });
        });

        function removeImage() {
            const avatarFile = document.getElementById('avatarFile');
            const avatarPreview = document.getElementById('avatarPreview');

            // Reset file input
            avatarFile.value = '';

            // Hide the preview image
            avatarPreview.style.display = 'none';
            avatarPreview.src = '';
        }
    </script>
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"
            crossorigin="anonymous"></script>
    <script th:inline="javascript">
        var existingNames = /*[[${nameList}]]*/ [];
        var nameRegex = /^[a-zA-ZÀ-Ỹà-ỹ\s]+$/;
        var phoneRegex = /^[0-9]{10,11}$/;
        var moneyRegex = /^[0-9]+$/;
        var today = new Date().toISOString().split("T")[0];
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("profile-form");

            const name = document.getElementById("name");
            const price = document.getElementById("price");
            const shortDesc = document.getElementById("shortDesc");
            const detailDesc = document.getElementById("detailDesc");
            const storage = document.getElementById("storage");
            const category = document.getElementById("category");
            const avatarFile = document.getElementById("avatarFile");

            // Hàm tạo thông báo lỗi bên dưới input
            function showError(input, message) {
                let errorElement = input.nextElementSibling;

                if (!errorElement || !errorElement.classList.contains("error-message")) {
                    errorElement = document.createElement("p");
                    errorElement.classList.add("error-message");
                    errorElement.style.color = "red";
                    errorElement.style.fontWeight = "bold";
                    errorElement.style.marginTop = "5px";
                    input.parentNode.appendChild(errorElement);
                }

                errorElement.textContent = message;
            }

            // Hàm xóa thông báo lỗi
            function clearError(input) {
                let errorElement = input.nextElementSibling;
                if (errorElement && errorElement.classList.contains("error-message")) {
                    errorElement.remove();
                }
            }

            form.addEventListener("submit", function (event) {
                let hasError = false;

                // Kiểm tra name
                clearError(name);
                if (name.value.trim() === "") {
                    showError(name, "Food Name is not empty");
                    hasError = true;
                } else if (!name.value.match(nameRegex)) { // Kiểm tra ký tự đặc biệt & số
                    showError(name, "Food Name must not contain numbers or special characters.");
                    hasError = true;
                } else if(existingNames.includes(name.value)){
                    showError(name, "Food Name is not duplicate.");
                    hasError = true;
                }

                // Kiểm tra price
                clearError(price);
                if (price.value.trim() === "") {
                    showError(price, "Price is required.");
                    hasError = true;
                } else if (!/^\d+(\.\d{1,2})?$/.test(price.value)) {
                    showError(price, "Price must be a valid number.");
                    hasError = true;
                }

                // Kiểm tra short description
                clearError(shortDesc);
                if (shortDesc.value.trim() === "") {
                    showError(shortDesc, "Short Description is required.");
                    hasError = true;
                }

                // Kiểm tra detail description
                clearError(detailDesc);
                if (detailDesc.value.trim() === "") {
                    showError(detailDesc, "Detail Description is required.");
                    hasError = true;
                }

                // Kiểm tra storage
                clearError(storage);
                if (storage.value.trim() === "") {
                    showError(storage, "Storage information is required.");
                    hasError = true;
                }

                // Kiểm tra category
                clearError(category);
                if (category.value.trim() === "") {
                    showError(category, "Category must be selected.");
                    hasError = true;
                }

                // Kiểm tra file upload
                clearError(avatarFile);
                if (avatarFile.value.trim() === "") {
                    showError(avatarFile, "Please upload a product image.");
                    hasError = true;
                }

                // Nếu có lỗi, ngăn form submit
                if (hasError) {
                    event.preventDefault();
                }
            });
        });
    </script>
</head>

<body class="sb-nav-fixed">
<header th:replace="~{admin/layout/header :: header}"></header>
<div id="layoutSidenav">
    <aside th:replace="~{admin/layout/sideBar :: sidebar}"></aside>
    <div id="layoutSidenav_content">
        <main>
            <div class="container-fluid px-4">
                <h1 class="mt-4">Manage Products</h1>
                <ol class="breadcrumb mb-4">
                    <li class="breadcrumb-item"><a th:href="@{/product/list-product-admin}">Dashboard</a></li>
                    <li class="breadcrumb-item">Products</li>
                    <li class="breadcrumb-item active">Create Product</li>
                </ol>
                <div class="mt-5">
                    <div class="row">
                        <div class="col-md-6 col-12 mx-auto">
                            <h3>Create Food</h3>
                            <hr />
                            <form id="profile-form" method="POST" th:action="@{/product/add-product}" enctype="multipart/form-data" class="row">
                                <div class="mb-3 col-12 col-md-6">
                                    <label class="form-label">Name:</label>
                                    <input type="text" class="form-control" id="name" name="name"/>
                                </div>
                                <div class="mb-3 col-12 col-md-6">
                                    <label class="form-label">Price:</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="price" name="price" value="0.0" min="0" step="any" />
                                        <span class="input-group-text">VNĐ</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Short description:</label>
                                    <input type="text" class="form-control" id="shortDesc" name="shortDesc" />
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Detail description:</label>
                                    <textarea class="form-control" id="detailDesc" name="detailDesc" rows="5" style="resize: vertical; width: 100%;"></textarea>
                                </div>
<!--                                <div class="mb-3">-->
<!--                                    <label class="form-label">Target:</label>-->
<!--                                    <input type="text" class="form-control" name="target" />-->
<!--                                </div>-->
                                <div class="mb-3">
                                    <label class="form-label">Storage:</label>
                                    <select class="form-select" id="storage"  name="storage">
                                        <option value="True">In stock</option>
                                        <option value="False">Out of stock</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Category:</label>
                                    <select class="form-select" name="category" id="category" >
                                        <option value="1">Desserts</option>
                                        <option value="2">Asian Dishes</option>
                                        <option value="3">European Dishes</option>
                                        <option value="4">Drinks</option>
                                        <option value="5">Cakes</option>
                                    </select>
                                </div>
                                <div class="mb-3 col-12 col-md-6">
                                    <label for="avatarFile" class="form-label">Images:</label>
                                    <input class="form-control" type="file" id="avatarFile" accept=".png, .jpg, .jpeg" name="productFile" onchange="previewImage(event)" />
                                </div>

                                <div class="col-12 mb-3" style="margin-top : 30px;">
                                    <button type="submit" class="btn btn-primary">Create</button>
                                    <a th:href="@{/product/list-product-admin}" class="btn btn-success">Back</a>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer th:replace="~{admin/layout/footer :: footer}"></footer>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
<script th:src="@{/js/scripts.js}"></script>
</body>
</html>