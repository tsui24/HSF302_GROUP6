<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Delete Product</title>
    <link th:href="@{/css/styles.css}" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <style>
        /* Đảm bảo modal hiển thị trên cùng */
        .modal {
            display: none;
            position: fixed;
            z-index: 1100; /* Đặt z-index cao hơn sidebar và header */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }

        /* Điều chỉnh kích thước ảnh trong modal */
        .modal-content {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
            z-index: 1110; /* Đảm bảo ảnh nổi lên trên các phần khác */
        }

        /* Nút đóng modal */
        .close {
            position: absolute;
            top: 15px;
            right: 25px;
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1120;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .thumbnail:hover {
            transform: scale(2);
        }
    </style>
</head>

<body class="sb-nav-fixed">
<header th:replace="~{admin/layout/header :: header}"></header>
<div id="layoutSidenav">
    <aside th:replace="~{admin/layout/sidebar :: sidebar}"></aside>
    <div id="layoutSidenav_content">
        <main>
            <div class="container-fluid px-4">
                <h1 class="mt-4">Products</h1>
                <ol class="breadcrumb mb-4">
                    <li class="breadcrumb-item"><a th:href="@{/product/list-product-admin}">Dashboard</a></li>
                    <li class="breadcrumb-item">Products</li>
                    <li class="breadcrumb-item active">Delete</li>
                </ol>
                <div class="container mt-5">
                    <div class="row">
                        <div class="col-12 mx-auto">
                            <div class="alert alert-danger">
                                Are you sure to delete this product?
                            </div>
                            <form id="profile-form" th:action="@{/product/update}" method="POST" enctype="multipart/form-data" class="row">

                                <!-- Name -->
                                <div class="mb-3 col-12 col-md-6">
                                    <label class="form-label">Name:</label>
                                    <input type="text" class="form-control" id="productName" name="productName" th:value="${product.name}" disabled />
                                </div>

                                <!-- Price -->
                                <div class="mb-3 col-12 col-md-6">
                                    <label class="form-label">Price:</label>
                                    <input type="number" class="form-control" id="price" name="price" th:value="${product.price}" disabled />
                                </div>

                                <!-- Detail Description -->
                                <div class="mb-3">
                                    <label class="form-label">Detail description:</label>
                                    <textarea class="form-control" id="detailDesc" name="detailDesc" rows="5"
                                              style="resize: vertical; width: 100%;" th:text="${product.detailDescription}" disabled ></textarea>
                                </div>

                                <!-- Short Description -->
                                <div class="mb-3 col-12 col-md-6">
                                    <label class="form-label">Short description:</label>
                                    <input type="text" class="form-control" id="shortDetail" name="shortDetail" th:value="${product.shortDescription}" disabled />
                                </div>

                                <!-- Storage -->
                                <div class="mb-3 col-12 col-md-6">
                                    <label class="form-label">Storage:</label>
                                    <select class="form-select" id="storage"  name="storage" disabled>
                                        <option value="True" th:selected="${product.storage == 'True'}">In stock</option>
                                        <option value="False" th:selected="${product.storage == 'False'}">Out of stock</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Category:</label>
                                    <select class="form-select" name="category" id="category" disabled >
                                        <option value="1" th:selected="${product.category.id == '1'}">Desserts</option>
                                        <option value="2" th:selected="${product.category.id == '2'}">Asian Dishes</option>
                                        <option value="3" th:selected="${product.category.id == '3'}">European Dishes</option>
                                        <option value="4" th:selected="${product.category.id == '4'}">Drinks</option>
                                        <option value="5" th:selected="${product.category.id == '5'}">Cakes</option>
                                    </select>
                                </div>
                                <div class="mb-3 col-12 col-md-6">
                                    <input type="hidden" id="oldImage" name="oldImage" th:value="${product.image}" />
                                    <label class="form-label">Image:</label>

                                    <!-- Hiển thị ảnh preview -->
                                    <div class="mt-3">
                                        <img th:if="${product.image != null}"
                                             th:src="@{/product/image/{filename}(filename=${product.image})}"
                                             id="avatarPreview"
                                             style="max-width: 200px; max-height: 150px; object-fit: contain; border: 1px solid #ddd; border-radius: 5px; padding: 5px;"
                                             alt="Current Image" onclick="openImageModal(this.src)"/>
                                    </div>
                                </div>

                                <script>
                                    document.addEventListener("DOMContentLoaded", function () {
                                        const avatarFile = document.getElementById("avatarFile");
                                        const fileName = document.getElementById("fileName");
                                        const avatarPreview = document.getElementById("avatarPreview");

                                        avatarFile.addEventListener("change", function (event) {
                                            if (event.target.files.length > 0) {
                                                const imgURL = URL.createObjectURL(event.target.files[0]);
                                                avatarPreview.src = imgURL;
                                                avatarPreview.style.display = "block";

                                                // Hiển thị tên file đã chọn
                                                fileName.textContent = event.target.files[0].name;
                                            } else {
                                                fileName.textContent = "Chưa có ảnh nào được chọn";
                                            }
                                        });
                                    });
                                </script>
                            </form>

                            <form th:action="@{/product/delete}" method="POST">
                                <div class="mb-3" style="display: none;">
                                    <input type="hidden" class="form-control" name="productId" th:value="${product.id}" />
                                </div>

                                <div class="col-12 mb-5 button-container" style="margin-top : 30px;">
                                    <button class="btn btn-danger">Confirm</button>
                                    <a th:href="@{/product/list-product-admin}" class="btn btn-success">Back</a>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer th:replace="~{admin/layout/footer :: footer}"></footer>
    </div>
</div>
<div id="imageModal" class="modal">
    <span class="close" onclick="closeImageModal()"> X </span>
    <img class="modal-content" id="modalImg">
</div>

<script>
    function openImageModal(src) {
        let modal = document.getElementById("imageModal");
        let modalImg = document.getElementById("modalImg");

        modal.style.display = "flex"; // Hiển thị modal
        modalImg.src = src;
        modalImg.style.maxWidth = "90vw"; // Đảm bảo không bị phóng đại quá mức
        modalImg.style.maxHeight = "90vh";
    }

    function closeImageModal() {
        document.getElementById("imageModal").style.display = "none";
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script th:src="@{/js/scripts.js}"></script>
</body>

</html>